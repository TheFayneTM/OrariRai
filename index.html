<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RAI Schedule Converter</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide icons CDN -->
  <script type="module">
    import * as lucide from 'https://cdn.jsdelivr.net/npm/lucide@0.278.0/dist/esm/lucide.js';
    window.lucide = lucide;
  </script>
  <!-- React and ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body class="bg-slate-900 min-h-screen">
  <div id="root"></div>

  <script type="text/javascript">
    const { useState } = React;
    const { Calendar, Upload, Download, AlertCircle, CheckCircle } = window.lucide;

    function RAIScheduleConverter() {
      const [file, setFile] = useState(null);
      const [employeeName, setEmployeeName] = useState('');
      const [status, setStatus] = useState('');
      const [error, setError] = useState('');
      const [schedule, setSchedule] = useState(null);
      const [processing, setProcessing] = useState(false);

      // For brevity, we keep only part of the shiftTimes and locations here
      const shiftTimes = { 'H': ['11:00', '19:30'], 'XXX': ['00:00','00:00'] };
      const locations = { 'N1':'Nomentano 1', 'Disp.':'Disposizione' };

      const createEventTitle = (shift, location, obVan) => {
        let title = shift;
        if(location && locations[location]) title += `, ${locations[location]}`;
        else if(location) title += `, ${location}`;
        if(obVan) title += `, OB${obVan}`;
        return title;
      };

      const handleFileUpload = (e) => {
        const uploadedFile = e.target.files[0];
        if(!uploadedFile) return;
        if(uploadedFile.type !== 'application/pdf') { setError('Per favore carica un file PDF'); return; }
        setFile(uploadedFile); setError(''); setStatus('');
      };

      const processSchedule = async () => {
        if(!file || !employeeName.trim()){ setError('Per favore carica un file e inserisci il nome del dipendente'); return; }
        setProcessing(true); setError(''); setStatus('Elaborazione in corso...');

        try {
          // Simulated schedule extraction for demo purposes
          const weekStart = new Date();
          const scheduleData = [
            { shift: 'H', location: 'N1', obVan: '' },
            { shift: 'XXX', location: '', obVan: '' },
            { shift: 'H', location: 'Disp.', obVan: '' },
            { shift: 'XXX', location: '', obVan: '' },
            { shift: 'H', location: 'N1', obVan: '' },
            { shift: 'H', location: 'N1', obVan: '' },
            { shift: 'XXX', location: '', obVan: '' }
          ];
          setSchedule({ data: scheduleData, weekStart });
          setStatus('Programma estratto con successo!');
          setProcessing(false);
        } catch(err) {
          setError(`Errore: ${err.message}`);
          setStatus('');
          setProcessing(false);
        }
      };

      const downloadICS = () => {
        if(!schedule) return;
        const icsContent = "BEGIN:VCALENDAR\nVERSION:2.0\nEND:VCALENDAR"; // simplified
        const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `turni_${employeeName.replace(/\s+/g,'_')}.ics`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      return React.createElement('div', { className: 'max-w-4xl mx-auto p-6' },
        React.createElement('h1', { className: 'text-white text-3xl mb-4' }, 'Convertitore Turni RAI'),
        React.createElement('input', { type:'text', placeholder:'Nome e Cognome', value:employeeName, onChange:e=>setEmployeeName(e.target.value), className:'p-2 rounded mb-2 w-full' }),
        React.createElement('input', { type:'file', accept:'.pdf', onChange:handleFileUpload, className:'mb-2 w-full' }),
        React.createElement('button', { onClick:processSchedule, className:'bg-purple-600 text-white p-2 rounded w-full mb-2' }, processing?'Elaborazione...':'Elabora Programma'),
        status && React.createElement('div', { className:'text-green-400 mb-2' }, status),
        error && React.createElement('div', { className:'text-red-400 mb-2' }, error),
        schedule && React.createElement('button', { onClick:downloadICS, className:'bg-green-600 text-white p-2 rounded w-full mt-2' }, 'Scarica .ICS')
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(RAIScheduleConverter));
  </script>
</body>
</html>
